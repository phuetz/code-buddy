<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 950 700" font-family="'Segoe UI', Arial, sans-serif">
  <defs>
    <linearGradient id="localizeGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#667eea"/>
      <stop offset="100%" style="stop-color:#764ba2"/>
    </linearGradient>
    <linearGradient id="generateGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#11998e"/>
      <stop offset="100%" style="stop-color:#38ef7d"/>
    </linearGradient>
    <linearGradient id="validateGrad2" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4facfe"/>
      <stop offset="100%" style="stop-color:#00f2fe"/>
    </linearGradient>
    <linearGradient id="feedbackGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#f093fb"/>
      <stop offset="100%" style="stop-color:#f5576c"/>
    </linearGradient>
    <linearGradient id="successGrad" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#48bb78"/>
      <stop offset="100%" style="stop-color:#276749"/>
    </linearGradient>
    <filter id="shadow">
      <feDropShadow dx="2" dy="2" stdDeviation="3" flood-opacity="0.3"/>
    </filter>
    <filter id="glow">
      <feGaussianBlur stdDeviation="3" result="coloredBlur"/>
      <feMerge>
        <feMergeNode in="coloredBlur"/>
        <feMergeNode in="SourceGraphic"/>
      </feMerge>
    </filter>
    <marker id="arrowRepair" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#ffd700"/>
    </marker>
    <marker id="arrowSuccess" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#48bb78"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="950" height="700" fill="#0f0f23"/>

  <!-- Title -->
  <text x="475" y="40" text-anchor="middle" fill="white" font-size="26" font-weight="bold">
    Boucle de Réparation Itérative (ChatRepair)
  </text>
  <text x="475" y="68" text-anchor="middle" fill="#718096" font-size="14">
    Localiser, Générer, Valider, Apprendre — Maximum 5 itérations
  </text>

  <!-- Bug Report input -->
  <g transform="translate(350, 90)" filter="url(#shadow)">
    <rect x="0" y="0" width="250" height="60" rx="12" fill="#2d3748" stroke="#fc8181" stroke-width="3"/>
    <text x="125" y="22" text-anchor="middle" fill="#fc8181" font-size="12" font-weight="bold">BUG REPORT</text>
    <text x="125" y="45" text-anchor="middle" fill="#e2e8f0" font-size="11">Test qui échoue / Erreur</text>
  </g>

  <!-- Arrow to Step 1 -->
  <path d="M475 155 L475 185" stroke="#4a5568" stroke-width="3" marker-end="url(#arrowRepair)"/>

  <!-- Step 1: Localization -->
  <g transform="translate(250, 190)" filter="url(#shadow)">
    <rect x="0" y="0" width="450" height="100" rx="15" fill="#1a1a3a" stroke="url(#localizeGrad)" stroke-width="3"/>
    <rect x="0" y="0" width="70" height="100" rx="15" fill="url(#localizeGrad)"/>
    <text x="35" y="55" text-anchor="middle" fill="white" font-size="24" font-weight="bold">1</text>

    <text x="100" y="30" fill="#667eea" font-size="16" font-weight="bold">LOCALISATION</text>
    <text x="100" y="52" fill="#a0aec0" font-size="11">"Où est le bug exactement ?"</text>
    <text x="100" y="72" fill="#718096" font-size="10">Stack trace • SBFL (Ochiai/DStar) • LLM</text>

    <g transform="translate(320, 25)">
      <rect x="0" y="0" width="110" height="50" rx="6" fill="#2d3748"/>
      <text x="55" y="20" text-anchor="middle" fill="#e2e8f0" font-size="10">Fichier suspect</text>
      <text x="55" y="38" text-anchor="middle" fill="#ffd700" font-size="11" font-weight="bold">math.ts:45</text>
    </g>
  </g>

  <!-- Arrow to Step 2 -->
  <path d="M475 295 L475 325" stroke="#4a5568" stroke-width="3" marker-end="url(#arrowRepair)"/>

  <!-- Step 2: Generation -->
  <g transform="translate(250, 330)" filter="url(#shadow)">
    <rect x="0" y="0" width="450" height="100" rx="15" fill="#1a1a3a" stroke="url(#generateGrad)" stroke-width="3"/>
    <rect x="0" y="0" width="70" height="100" rx="15" fill="url(#generateGrad)"/>
    <text x="35" y="55" text-anchor="middle" fill="white" font-size="24" font-weight="bold">2</text>

    <text x="100" y="30" fill="#38ef7d" font-size="16" font-weight="bold">GÉNÉRATION</text>
    <text x="100" y="52" fill="#a0aec0" font-size="11">"Propose un correctif"</text>
    <text x="100" y="72" fill="#718096" font-size="10">Templates • LLM avec historique • Contexte ciblé</text>

    <g transform="translate(320, 25)">
      <rect x="0" y="0" width="110" height="50" rx="6" fill="#2d3748"/>
      <text x="55" y="18" text-anchor="middle" fill="#e2e8f0" font-size="9">Patch généré</text>
      <text x="10" y="35" fill="#f56565" font-size="9">-</text>
      <text x="20" y="35" fill="#a0aec0" font-size="9">return x/y</text>
      <text x="10" y="47" fill="#48bb78" font-size="9">+</text>
      <text x="20" y="47" fill="#a0aec0" font-size="9">if(y===0)...</text>
    </g>
  </g>

  <!-- Arrow to Step 3 -->
  <path d="M475 435 L475 465" stroke="#4a5568" stroke-width="3" marker-end="url(#arrowRepair)"/>

  <!-- Step 3: Validation -->
  <g transform="translate(250, 470)" filter="url(#shadow)">
    <rect x="0" y="0" width="450" height="100" rx="15" fill="#1a1a3a" stroke="url(#validateGrad2)" stroke-width="3"/>
    <rect x="0" y="0" width="70" height="100" rx="15" fill="url(#validateGrad2)"/>
    <text x="35" y="55" text-anchor="middle" fill="white" font-size="24" font-weight="bold">3</text>

    <text x="100" y="30" fill="#4facfe" font-size="16" font-weight="bold">VALIDATION</text>
    <text x="100" y="52" fill="#a0aec0" font-size="11">"Est-ce que ça marche ?"</text>
    <text x="100" y="72" fill="#718096" font-size="10">Exécuter les tests • Analyser les résultats</text>

    <g transform="translate(310, 25)">
      <rect x="0" y="0" width="60" height="50" rx="6" fill="#2d3748"/>
      <text x="30" y="22" text-anchor="middle" fill="#e2e8f0" font-size="10">Tests</text>
      <text x="30" y="42" text-anchor="middle" fill="#48bb78" font-size="14">✓ ?</text>
    </g>

    <g transform="translate(380, 25)">
      <rect x="0" y="0" width="60" height="50" rx="6" fill="#2d3748"/>
      <text x="30" y="22" text-anchor="middle" fill="#e2e8f0" font-size="10">ou</text>
      <text x="30" y="42" text-anchor="middle" fill="#f56565" font-size="14">✗</text>
    </g>
  </g>

  <!-- Decision diamond -->
  <g transform="translate(400, 585)">
    <polygon points="75,0 150,40 75,80 0,40" fill="#1a1a3a" stroke="#ffd700" stroke-width="3"/>
    <text x="75" y="35" text-anchor="middle" fill="#ffd700" font-size="11" font-weight="bold">Succès</text>
    <text x="75" y="50" text-anchor="middle" fill="#ffd700" font-size="11" font-weight="bold">?</text>
  </g>

  <!-- Arrow from validation to decision -->
  <path d="M475 575 L475 580" stroke="#4a5568" stroke-width="3"/>

  <!-- Yes arrow to success -->
  <path d="M555 625 L680 625" stroke="#48bb78" stroke-width="3" marker-end="url(#arrowSuccess)"/>
  <text x="610" y="618" fill="#48bb78" font-size="12" font-weight="bold">OUI</text>

  <!-- Success box -->
  <g transform="translate(700, 590)" filter="url(#glow)">
    <rect x="0" y="0" width="150" height="70" rx="15" fill="url(#successGrad)"/>
    <text x="75" y="30" text-anchor="middle" fill="white" font-size="16" font-weight="bold">SUCCÈS</text>
    <text x="75" y="50" text-anchor="middle" fill="rgba(255,255,255,0.9)" font-size="11">Bug corrigé</text>
  </g>

  <!-- No arrow to feedback -->
  <path d="M400 625 L100 625 L100 360 L180 360" stroke="#f5576c" stroke-width="3" stroke-dasharray="10,5"/>
  <text x="125" y="618" fill="#f5576c" font-size="12" font-weight="bold">NON</text>

  <!-- Feedback box on the left -->
  <g transform="translate(30, 300)" filter="url(#shadow)">
    <rect x="0" y="0" width="180" height="120" rx="12" fill="#1a1a3a" stroke="url(#feedbackGrad)" stroke-width="3"/>
    <rect x="0" y="0" width="180" height="35" rx="12" fill="url(#feedbackGrad)"/>
    <text x="90" y="24" text-anchor="middle" fill="white" font-size="13" font-weight="bold">4. FEEDBACK</text>

    <g transform="translate(15, 50)">
      <text x="0" y="0" fill="#a0aec0" font-size="10">• Analyse l'erreur</text>
      <text x="0" y="18" fill="#a0aec0" font-size="10">• Historique tentatives</text>
      <text x="0" y="36" fill="#a0aec0" font-size="10">• Force approche différente</text>
      <text x="0" y="56" fill="#f5576c" font-size="10" font-weight="bold">→ Retour à étape 2</text>
    </g>
  </g>

  <!-- Iteration counter -->
  <g transform="translate(750, 100)">
    <rect x="0" y="0" width="160" height="100" rx="10" fill="#1a1a3a" stroke="#ed8936" stroke-width="2"/>
    <text x="80" y="25" text-anchor="middle" fill="#ed8936" font-size="13" font-weight="bold">Itérations</text>

    <text x="80" y="55" text-anchor="middle" fill="#e2e8f0" font-size="24" font-weight="bold">max 5</text>
    <text x="80" y="80" text-anchor="middle" fill="#718096" font-size="10">Rendements décroissants</text>
    <text x="80" y="95" text-anchor="middle" fill="#718096" font-size="10">au-delà</text>
  </g>

  <!-- Stats comparison -->
  <g transform="translate(750, 220)">
    <rect x="0" y="0" width="160" height="130" rx="10" fill="#1a1a3a" stroke="#4a5568" stroke-width="2"/>
    <text x="80" y="25" text-anchor="middle" fill="#e2e8f0" font-size="12" font-weight="bold">Amélioration</text>

    <g transform="translate(15, 40)">
      <text x="0" y="0" fill="#fc8181" font-size="11">Single-shot:</text>
      <text x="100" y="0" fill="#fc8181" font-size="11" font-weight="bold">~15%</text>

      <text x="65" y="20" text-anchor="middle" fill="#718096" font-size="14">↓</text>

      <text x="0" y="40" fill="#48bb78" font-size="11">Itératif:</text>
      <text x="100" y="40" fill="#48bb78" font-size="11" font-weight="bold">~40%</text>

      <text x="0" y="70" fill="#ffd700" font-size="12" font-weight="bold">+167%</text>
    </g>
  </g>

  <!-- Learning indicator -->
  <g transform="translate(750, 370)">
    <rect x="0" y="0" width="160" height="90" rx="10" fill="#1a1a3a" stroke="#764ba2" stroke-width="2"/>
    <text x="80" y="25" text-anchor="middle" fill="#764ba2" font-size="12" font-weight="bold">Apprentissage</text>

    <g transform="translate(15, 40)">
      <text x="0" y="0" fill="#a0aec0" font-size="10">Patterns mémorisés:</text>
      <text x="0" y="18" fill="#48bb78" font-size="10">• null_check (89%)</text>
      <text x="0" y="33" fill="#48bb78" font-size="10">• add_await (76%)</text>
      <text x="0" y="48" fill="#48bb78" font-size="10">• try_catch (71%)</text>
    </g>
  </g>
</svg>
